<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      LNN's swiss-knife util
    </title>
    <style>
      button{
        padding:4px 8px;
      }
      #textAndOut {
        display: flex;
        flex-wrap: wrap;
      }
      #textAndOut textarea {
        flex: 1;
        min-width: 267px;
        height: 300px;
        resize: none;
      }
    </style>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/codemirror/5.58.3/codemirror.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/5.58.3/codemirror.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/codemirror/5.58.3/mode/javascript/javascript.min.js"></script>
    <script src="/js/utils.js"></script>
  </head>
  <body>
    <h1>
      LNN's swiss-knife util
    </h1>
    <div id="codeDiv">
      <div id="codeToolbarDiv">
        <button onclick="codeCm.focus(),codeCm.execCommand('selectAll')">
          select all
        </button>
        <button onclick="codeCm.focus(),codeCm.execCommand('undo')">
          undo
        </button>
        <button onclick="codeCm.focus(),codeCm.execCommand('redo')">
          redo
        </button>
        <button onclick="codeCm.focus(),codeCm.execCommand('defaultTab')">
          tab
        </button>
      </div>
    </div>
    <div style="margin:8px 0">
      <div>
        out &lt;-
        <button onclick="try{let __r=eval(codebox.value);out.value=__r}catch(e){out.value=e}">
          eval code
        </button>
        <button onclick="var r='',d;for(d of text.value){let c=d.codePointAt(0).toString(16),m=c.length;r+=m&gt;4?`\\u{${c}}`:m===4?`\\u${c}`:m===3?`\\u0${c}`:m===2?`\\x${c}`:`\\x0${c}`}out.value=`&quot;${r}&quot;`">
          code point escape text
        </button>
        <button onclick="out.value=`codebox.value=${JSON.stringify(codebox.value)},text.value=${JSON.stringify(text.value)}`">
          dump code & text
        </button>
      </div>
      <div>
        out &lt;- utf-8 + base64
        <button onclick="out.value=Base64LNN.encodeUTF8(text.value)">
          encode
        </button>
        <button onclick="out.value=Base64LNN.decodeUTF8(text.value)">
          decode
        </button>
        text
      </div>
      <div>
        out &lt;- uri-component
        <button onclick="out.value=encodeURIComponent(text.value)">
          encode
        </button>
        <button onclick="out.value=decodeURIComponent(text.value)">
          decode
        </button>
        text
      </div>
      <div>
        out &lt;- html
        <button onclick="out.value=text.value.replace(/&amp;/g,'&amp;amp;').replace(/&lt;/g,'&amp;lt;').replace(/&gt;/g,'&amp;gt;')">
          escape &amp;&lt;&gt;
        </button>
        <button onclick="out.value=text.value.replace(/&amp;/g,'&amp;amp;').replace(/&quot;/g,'&amp;quot;').replace(/&lt;/g,'&amp;lt;').replace(/&gt;/g,'&amp;gt;')">
          escape &amp;&lt;&gt;"
        </button>
        <button onclick="out.value=text.value.replace(/&amp;/g,'&amp;amp;').replace(/'/g,'&amp;apos;').replace(/&lt;/g,'&amp;lt;').replace(/&gt;/g,'&amp;gt;')">
          escape &amp;&lt;&gt;'
        </button>
        <button onclick="let e=document.createElement('div');out.value=text.value.replace(/&amp;[^&amp;&lt;&gt;&quot;&apos;\s;]+;/g,f=&gt;(e.innerHTML=f, e.textContent))">
          unescape
        </button>
        text
      </div>
      <div>
        out &lt;- read
        <button onclick="file.click()">
          #file
        </button>
        as
        <button onclick="var r=new FileReader();r.onload=()=>{out.value=r.result};r.readAsText(file.files[0])">
          text
        </button>
        <button onclick="var r=new FileReader();r.onload=()=>{out.value=r.result};r.readAsDataURL(file.files[0])">
          data url
        </button>
      </div>
      <div>
        swap
        <button onclick="[codebox.value,out.value]=[out.value,codebox.value]">
          code, out
        </button>
        <button onclick="[text.value,out.value]=[out.value,text.value]">
          text, out
        </button>
        <button onclick="[codebox.value,text.value]=[text.value,codebox.value]">
          code, text
        </button>
      </div>
    </div>
    <div id="textAndOut">
      <textarea id="text" placeholder="#text"></textarea>
      <textarea id="out" placeholder="#out" readonly></textarea>
    </div>
    <input type="file" id="file" style="display:none">
    <script>
      var codebox = {
        get value() {
          return codeCm.getValue();
        },
        set value(v) {
          codeCm.setValue(v);
        }
      };
      var codeCm = new CodeMirror(codeDiv, {
        lineNumbers: true,
        lineWrapping: true,
        indentUnit: 4
      });
    </script>
  </body>
</html>
